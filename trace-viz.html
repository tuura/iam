<!DOCTYPE html>
<head>
<script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>
<script src="https://dagrejs.github.io/project/graphlib/latest/graphlib.min.js"></script>
<script src="https://dagrejs.github.io/project/dagre/latest/dagre.min.js"></script>
<script src="https://dagrejs.github.io/project/dagre-d3/latest/dagre-d3.min.js"></script>
<link rel="stylesheet" href="tipsy.css">
<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.2.min.js"></script>
<script src="tipsy.js"></script>
<style>
    text {
        font-weight: 300;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serf;
        font-size: 14px;
    }

    .node rect {
        stroke: #333;
        fill: #fff;
    }

    .edgePath path {
        stroke: #333;
        fill: #333;
        stroke-width: 1.5px;
    }

    .node text {
        pointer-events: none;
    }

    /* This styles the title of the tooltip */
    .tipsy .name {
        font-size: 1.5em;
        font-weight: bold;
        color: #60b1fc;
        margin: 0;
    }

    /* This styles the body of the tooltip */
    .tipsy .description {
        font-size: 1em;
        text-align: left;
    }
</style>
</head>

<body>


<svg width="1000" height="1000"></svg>
<script>
// Create a new directed graph
var g = new dagreD3.graphlib.Graph().setGraph({});

// States and transitions from RFC 793
var states = {
    "(0,Set R0 0)": {
        description: `<pre>IC: 0
IR: Jump 0
Flags: [(Zero,0),(Overflow,0),(Halted,0)]
Path Constraints: 

</pre>`
    }, "(1,Store R0 255)": {
        description: `<pre>IC: 1
IR: Set R0 0
Flags: [(Zero,0),(Overflow,0),(Halted,0)]
Path Constraints: 

</pre>`
    }, "(2,Load R0 1)": {
        description: `<pre>IC: 2
IR: Store R0 255
Flags: [(Zero,0),(Overflow,0),(Halted,0)]
Path Constraints: 

</pre>`
    },
    "(4,JumpZero 6)": {
        description: `<pre>IC: 4
IR: Sub R0 255
Flags: [(Zero,((val_0 % val_1) - 0)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(5,Load R0 0)": {
        description: `<pre>IC: 5
IR: JumpZero 6
Flags: [(Zero,((val_0 % val_1) - 0)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬(((val_0 % val_1) - 0) == 0)
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(11,Halt)": {
        description: `<pre>IC: 11
IR: JumpZero 6
Flags: [(Zero,((val_0 % val_1) - 0)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && (((val_0 % val_1) - 0) == 0)
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(12,Halt)": {
        description: `<pre>IC: 12
IR: Halt
Flags: [(Zero,((val_0 % val_1) - 0)),(Overflow,0),(Halted,1)]
Path Constraints: 
 && (((val_0 % val_1) - 0) == 0)
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(4,JumpZero 6)": {
        description: `<pre>IC: 4
IR: Sub R0 255
Flags: [(Zero,((val_1 % (val_0 % val_1)) - 0)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬(((val_0 % val_1) - 0) == 0)
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(4,JumpZero 6)": {
        description: `<pre>IC: 4
IR: Sub R0 255
Flags: [(Zero,(val_1 - 0)),(Overflow,0),(Halted,0)]
Path Constraints: 

</pre>`
    }, "(5,Load R0 0)": {
        description: `<pre>IC: 5
IR: JumpZero 6
Flags: [(Zero,(val_1 - 0)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(11,Halt)": {
        description: `<pre>IC: 11
IR: JumpZero 6
Flags: [(Zero,(val_1 - 0)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ((val_1 - 0) == 0)

</pre>`
    }, "(12,Halt)": {
        description: `<pre>IC: 12
IR: Halt
Flags: [(Zero,(val_1 - 0)),(Overflow,0),(Halted,1)]
Path Constraints: 
 && ((val_1 - 0) == 0)

</pre>`
    }, "(7,Load R1 1)": {
        description: `<pre>IC: 7
IR: Mod R0 1
Flags: [(Zero,(val_0 % val_1)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(3,Sub R0 255)": {
        description: `<pre>IC: 3
IR: Jump (-8)
Flags: [(Zero,(val_0 % val_1)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(8,Store R0 1)": {
        description: `<pre>IC: 8
IR: Load R1 1
Flags: [(Zero,(val_0 % val_1)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(9,Store R1 0)": {
        description: `<pre>IC: 9
IR: Store R0 1
Flags: [(Zero,(val_0 % val_1)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(10,Jump (-8))": {
        description: `<pre>IC: 10
IR: Store R1 0
Flags: [(Zero,(val_0 % val_1)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(3,Sub R0 255)": {
        description: `<pre>IC: 3
IR: Jump (-8)
Flags: [(Zero,(val_1 % (val_0 % val_1))),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬(((val_0 % val_1) - 0) == 0)
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(8,Store R0 1)": {
        description: `<pre>IC: 8
IR: Load R1 1
Flags: [(Zero,(val_1 % (val_0 % val_1))),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬(((val_0 % val_1) - 0) == 0)
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(9,Store R1 0)": {
        description: `<pre>IC: 9
IR: Store R0 1
Flags: [(Zero,(val_1 % (val_0 % val_1))),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬(((val_0 % val_1) - 0) == 0)
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(10,Jump (-8))": {
        description: `<pre>IC: 10
IR: Store R1 0
Flags: [(Zero,(val_1 % (val_0 % val_1))),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬(((val_0 % val_1) - 0) == 0)
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(7,Load R1 1)": {
        description: `<pre>IC: 7
IR: Mod R0 1
Flags: [(Zero,(val_1 % (val_0 % val_1))),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬(((val_0 % val_1) - 0) == 0)
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(6,Mod R0 1)": {
        description: `<pre>IC: 6
IR: Load R0 0
Flags: [(Zero,(val_1 - 0)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬((val_1 - 0) == 0)

</pre>`
    }, "(3,Sub R0 255)": {
        description: `<pre>IC: 3
IR: Load R0 1
Flags: [(Zero,0),(Overflow,0),(Halted,0)]
Path Constraints: 

</pre>`
    }, "(6,Mod R0 1)": {
        description: `<pre>IC: 6
IR: Load R0 0
Flags: [(Zero,((val_0 % val_1) - 0)),(Overflow,0),(Halted,0)]
Path Constraints: 
 && ¬(((val_0 % val_1) - 0) == 0)
 && ¬((val_1 - 0) == 0)

</pre>`
    }
};

// Add states to the graph, set labels, and style
Object.keys(states).forEach(function (state) {
    var value = states[state];
    value.label = state;
    value.rx = value.ry = 5;
    g.setNode(state, value);
});

g.setEdge("(4,JumpZero 6)", "(5,Load R0 0)", {});
g.setEdge("(4,JumpZero 6)", "(11,Halt)", {});
g.setEdge("(5,Load R0 0)", "(6,Mod R0 1)", {});
g.setEdge("(11,Halt)", "(12,Halt)", {});
g.setEdge("(4,JumpZero 6)", "(5,Load R0 0)", {});
g.setEdge("(4,JumpZero 6)", "(11,Halt)", {});
g.setEdge("(5,Load R0 0)", "(6,Mod R0 1)", {});
g.setEdge("(11,Halt)", "(12,Halt)", {});
g.setEdge("(7,Load R1 1)", "(8,Store R0 1)", {});
g.setEdge("(3,Sub R0 255)", "(4,JumpZero 6)", {});
g.setEdge("(8,Store R0 1)", "(9,Store R1 0)", {});
g.setEdge("(9,Store R1 0)", "(10,Jump (-8))", {});
g.setEdge("(10,Jump (-8))", "(3,Sub R0 255)", {});
g.setEdge("(3,Sub R0 255)", "(4,JumpZero 6)", {});
g.setEdge("(8,Store R0 1)", "(9,Store R1 0)", {});
g.setEdge("(9,Store R1 0)", "(10,Jump (-8))", {});
g.setEdge("(10,Jump (-8))", "(3,Sub R0 255)", {});
g.setEdge("(7,Load R1 1)", "(8,Store R0 1)", {});
g.setEdge("(0,Set R0 0)", "(1,Store R0 255)", {});
g.setEdge("(1,Store R0 255)", "(2,Load R0 1)", {});
g.setEdge("(2,Load R0 1)", "(3,Sub R0 255)", {});
g.setEdge("(6,Mod R0 1)", "(7,Load R1 1)", {});
g.setEdge("(3,Sub R0 255)", "(4,JumpZero 6)", {});
g.setEdge("(6,Mod R0 1)", "(7,Load R1 1)", {});


// Create the renderer
var render = new dagreD3.render();

// Set up an SVG group so that we can translate the final graph.
var svg = d3.select("svg"),
    inner = svg.append("g");

// Set up zoom support
var zoom = d3.zoom()
    .on("zoom", function () {
        inner.attr("transform", d3.event.transform);
    });
svg.call(zoom);

// Simple function to style the tooltip for the given node.
var styleTooltip = function (name, description) {
    return "<p class='name'>" + name + "</p><p class='description'>" + description + "</p>";
};

// Run the renderer. This is what draws the final graph.
render(inner, g);

inner.selectAll("g.node")
    .attr("title", function (v) { return styleTooltip(v, g.node(v).description) })
    .each(function (v) { $(this).tipsy({ gravity: "w", opacity: 1, html: true }); });

// Center the graph
var initialScale = 0.75;
svg.call(zoom.transform,
    d3.zoomIdentity.translate((svg.attr("width") - g.graph().width * initialScale) / 2, 20)
.scale(initialScale));

svg.attr('height', g.graph().height * initialScale + 40);
</script>
</body>

</html>